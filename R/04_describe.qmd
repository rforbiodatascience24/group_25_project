---
title: "Describe data"
format:
  html:
    embed-resources: true
editor: visual
---

# Load data & libraries

```{r}
#| message: false
library("tidyverse")
library("dplyr")
library(patchwork)
```

From the augment script, we will examine the following files

1\) All data; all genes, no replicates

2\) Filtered data; significant genes, no replicates (for overview of the data)

3\) Log data; significant genes, all 3 replicates (for PCA)

```{r}
data_dir <- "../data"
stats_data_file <- "/03_data_stats_load.tsv.gz"
filtered_stats_data_file <- "/03_data_filtered_stats.tsv.gz"
log_data_file <- "/03_data_log_load.tsv.gz" 

log_data <- read_tsv(str_c(data_dir, log_data_file))
all_data <- read_tsv(str_c(data_dir, stats_data_file))
filtered_data <- read_tsv(str_c(data_dir, filtered_stats_data_file))
```

# Attributes

For each gene ID, there are

-   mean_reads: raw count of sequencing reads mapped to a gene

-   mean_rpm: normalized value of mean_reads

-   mean_rpkm: normalized value of mean_rpm, by considering length of gene (in kilobases)

-   gene expression value: how much the gene is expressed (i.e. how actively it's producing its corresponding RNA)

# Size of each data and number of genes

In table below can be seen the dimensions of the 3 data frames. Each row corresponds to a unique gene.

```{r}
data_frames <- list(
  All_data = all_data,
  Filtered_data = filtered_data,
  Log_data = log_data
)

# Summarize their dimensions in a tidy table
map_dfr(
  data_frames,
  ~ tibble(
    rows = nrow(.x),
    columns = ncol(.x)
  ),
  .id = "data_frame"
)
```

In all_data, there are 19279 different RNA transcripts (genes, isoforms, miRNA, etc), while in filtered and log data there are 2036.

We will pivot the data to long format

```{r}
all_data_long <- log_data |> 
  pivot_longer(
    cols = contains(c("control", "tau")), 
    names_to = "experiment", 
    values_to = "gene_expression"
  )
```

Let's look at the experiments. There are 18 per gene.

```{r}
filtered_data |>
  group_by(gene_ensembl) |>
  summarise(row_count = n())
```

# Gene expression values

Let's find the range of the gene expression values. The log transformation performed in the augment script explains the negative values.

```{r}
gene_expression_summary <- all_data_long |>
  #group_by(gene_ID) |>
  summarize(
    mean_value = mean(gene_expression),
    min_value = min(gene_expression),
    max_value = max(gene_expression),
    count = n())

gene_expression_summary
```

# Pivot filtered data

We will also create a long format of the filtered data with mean values for plot vizualization

```{r}
filtered_data_long <- filtered_data |> 
  select(-starts_with("fold")) |> 
  pivot_longer(
    cols = contains(c("control", "tau")), 
    names_to = "experiment", 
    values_to = "gene_expression"
  )
```

# Visualizing the data

The data has been visualised below in separated plots for each experiment. Despite not accounting for different gene types, the plots depict a clear trend, with the control samples consistantly presenting greater gene expression. Furthermore, the fact that the control and tau curves follow such a similar shape indicates that is it likely that the increased tau protein has caused a linear shift in the gene expression.

```{r}
RPKMplot <- filtered_data_long |>
  filter(str_detect(experiment,
                    pattern = "RPKM")) |> 
  ggplot(mapping = aes(x = gene_expression,
                       fill = experiment)) + 
  geom_density(alpha = 0.5) + 
  theme_minimal() + 
  labs(title = "RPKM Data",
       y = "Density",
       x = "Mean Gene Expression")

RPMplot <- filtered_data_long |>
  filter(str_detect(experiment,
                    pattern = "RPM")) |> 
  ggplot(mapping = aes(x = gene_expression,
                       fill = experiment)) + 
  geom_density(alpha = 0.5) + 
  theme_minimal() + 
  labs(title = "RPM Data",
       y = "Density",
       x = "Mean Gene Expression")

readsplot <- filtered_data_long |>
  filter(str_detect(experiment,
                    pattern = "reads")) |> 
  ggplot(mapping = aes(x = gene_expression,
                       fill = experiment)) + 
  geom_density(alpha = 0.5) + 
  theme_minimal() + 
  labs(title = "Reads Data",
       y = "Density",
       x = "Mean Gene Expression")

# Combining the plots above each other
combined_plot <- RPKMplot / RPMplot / readsplot
combined_plot
```
