The following script will load the raw data set that contains 3 sheets to be joined:

-   The read counts for each experiment - The Reads Per Million (RPM) for each experiment.

-   The Reads Per Kilobase per Million mapped reads (RPKMs) for each experiment.

-   The output of this script will be a data set with all 3 sheets combined.

1.  Load Libraries

```{r}
#| message: false
library("tidyverse")
library(readxl)
library(R.utils)
```

2.  Load Raw Data
Since the readxl library does not direclt decompress .gz files we are required to use the R.utils library to manualy decompress our file
```{r}
raw_dir = "../_raw"
data_file = "/raw_data.xls"
data_path = str_c(raw_dir,data_file)
  # Use the R.utils library to decompress a gz file 
if(!dir.exists(raw_dir)) {
  dir.create(path = raw_dir)
}
  
if(!file.exists(data_path)) {
 gunzip("../_raw/GSE239956_counts_RPMs_RPKMs.xls.gz", remove = FALSE) #remove = TRUE will delete the .gz file 
  
 file.rename("../_raw/GSE239956_counts_RPMs_RPKMs.xls", data_path)}
```

3. Get Excel sheets

```{r}
reads_df <- read_excel(data_path, sheet = 1)
RPMs_df <- read_excel(data_path, sheet = 2)
RPKMs_df <- read_excel(data_path, sheet = 3)
```
Since there was an attribute without a name these collumns were named ...1 

4. Join all excel sheets into raw_data


```{r}
joined_data <- reads_df |> 
  full_join(RPMs_df,
            by = c("...1", "GeneName", "description"),
            relationship = "many-to-many") |> 
  full_join(RPKMs_df,
            by = c("...1", "GeneName", "description"),
            relationship = "many-to-many")
```

The data set is messy: the .x values corresponds to the reads dataframe, the .y to tge RPMs dataframe and the reamining values correspond to the RPKMs_df.

5. Load joined data

```{r}
joined_data |> 
  write_tsv(file = "../data/01_data_load.tsv.gz")
```





